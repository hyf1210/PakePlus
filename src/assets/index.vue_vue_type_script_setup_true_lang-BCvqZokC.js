import{_ as ie}from"./index.vue_vue_type_style_index_0_lang-CVeWsgLW.js";import{d as re,v as ue,Q as me,r as S,m as c,o as ce,a as de,V as j,G as pe,b as d,c as r,e as p,f as u,g as f,w as m,t as g,F as h,h as _,j as y,i as k,l as fe}from"./index-Xku4Yv_8.js";import{e as ve,f as ye,g as he,s as ge,h as we,i as _e,a as be,j as Ee,k as Ve,l as Ce,m as Le,n as Se,o as ke}from"./simulation-C2GBFQc4.js";import{S as xe}from"./dict-BKYb64jL.js";import{_ as n}from"./lodash-C7R_B3uJ.js";const Te={class:"config-simulation h100 flex flex-column"},$e={class:"flex-auto mt20"},Ae={class:"flex"},Ue={class:"flex items-center ml30"},Ie={class:"flex items-center ml20"},Ne={class:"flex items-center ml20"},je={key:3,class:"flex items-center ml20"},Fe={key:4,class:"flex items-center ml20"},Re=re({__name:"index",emits:["isDisabled"],setup(De,{emit:F}){const D=F,{t:w}=ue.useI18n(),P=me(),x=S(xe),i=S([]),B=S([]);c.on("sim:reset",()=>{$()}),c.on("sim:save",()=>{W()}),c.on("sim:start",()=>{R()}),c.on("dialog:simConfigGet",t=>{X(t)}),c.on("choose:eventStreamConfig",t=>{B.value=t;let e=n.find(i.value,a=>a.type==="eventStreamConfig");e=n.assign(e,{value:t})}),ce(()=>{$()}),de(()=>{c.off("sim:reset"),c.off("sim:save"),c.off("sim:start"),c.off("dialog:simConfigGet"),c.off("choose:eventStreamConfig"),A()});const G=({row:t,column:e,rowIndex:a,columnIndex:s})=>{if(s===0){const v=M("categoryLabel");return v[a]>0?[v[a],1]:[0,0]}},O=(t,e)=>{let a=w(`simulation.${t}`);return t==="CONFIG"&&(a={startTime:w("simulation.presetTime"),startLocation:w("simulation.presetLocation")}[e.type]??w("simulation.internalFile")),a},M=t=>{let e=[],a=0;for(let s=0;s<i.value.length;s++)s===0?(e.push(1),a=0):i.value[s][t]===i.value[s-1][t]?(e[a]+=1,e.push(0)):(e.push(1),a=s);return e},T=t=>{let e=!0;if(t.type==="startLocation"){let a=t.value;for(let[s,v]of Object.entries(a))if(n.isNil(v))return e=!1,!1}else if(!t.value)return e=!1,!1;return e},$=()=>{i.value=n.cloneDeep(x.value),J(),Q(),q(),z(),H(),K()},R=async()=>{if(b()){let t={};n(i.value).forEach(a=>{if(t[a.type]=n.pick(a,["dataType","value"]),a.type==="startTime"){let s=(a==null?void 0:a.value)/1e3;t.startTime.value=s}});const e=await ve(t);e.code===0?(j({message:e.msg,type:"success"}),c.emit("btn:hideStart"),P.push("/")):j({message:e.msg,type:"error"}),A()}},b=()=>{let t=!0;return n(i.value).forEach(e=>{if(e.dataType==="CONFIG"&&(!T(e)||!e.isExist))return t=!1,!1}),t},A=()=>{i.value=n.cloneDeep(x.value)},W=()=>{b()&&c.emit("dialog:simSaveConfig",i.value)},J=async()=>{const{data:t}=await ye();let e=n.find(i.value,a=>a.type==="trajectoryConfig");e=n.assign(e,{list:t})},Q=async()=>{const{data:t}=await he("bds");let e=n.find(i.value,a=>a.type==="bdsEph");e=n.assign(e,{list:n.map(t,"name")})},q=async()=>{const{data:t}=await ge();let e=n.find(i.value,a=>a.type==="antennaConfig");e=n.assign(e,{list:t})},z=async()=>{const{data:t}=await we();let e=n.find(i.value,a=>a.type==="atmosphericConfig");e=n.assign(e,{list:t})},H=async()=>{const{data:t}=await _e("bds");let e=n.find(i.value,a=>a.type==="bdsPower");e=n.assign(e,{list:t})},K=async()=>{const{data:t}=await be();let e=n.find(i.value,a=>a.type==="eventStreamConfig");e=n.assign(e,{list:t})},X=t=>{n.forEach(n.cloneDeep(t),async(e,a)=>{let s=n.find(i.value,v=>v.type===a);a==="startTime"&&e.value&&(e.value=e.value*1e3),a!=="startTime"&&e.dataType!=="INJECT"&&e.value&&!n.isEmpty(e.value)&&(s.isExist=await Y(s.type,e.value)),s=n.assign(s,e)})},Y=async(t,e)=>{let a=!1;switch(t){case"bdsEph":a=await Z("bds",e);break;case"bdsPower":a=await ee("bds",e);break;case"trajectoryConfig":a=await te(e);break;case"atmosphericConfig":a=await ae(e);break;case"antennaConfig":a=await le(e);break;case"eventStreamConfig":a=await oe(e);break;default:a=!0}return a},E=(t,e)=>{let a=n.find(i.value,s=>s.type===t);a.isExist=e},Z=async(t,e)=>{const{data:a}=await Ee(t,{name:e});return a},ee=async(t,e)=>{const{data:a}=await Ve(t,{name:e});return a},te=async t=>{const{data:e}=await Ce({...t});return e},ae=async t=>{const{data:e}=await Le({name:t});return e},le=async t=>{const{data:e}=await Se({name:t});return e},oe=async t=>{const{data:e}=await ke({name:t});return e};return pe(()=>i.value,t=>{let e=b();D("isDisabled",!e)},{deep:!0,immediate:!0}),(t,e)=>{const a=d("el-table-column"),s=d("el-radio"),v=d("el-radio-group"),ne=d("el-date-picker"),V=d("el-input-number"),C=d("el-option"),L=d("el-select"),U=d("WarningFilled"),I=d("el-icon"),N=d("el-tooltip"),se=d("el-table");return r(),p("div",Te,[u(ie,{label:"detailConfig"}),f("div",$e,[u(se,{class:"h100","show-header":!1,data:i.value,"span-method":G,border:""},{default:m(()=>[u(a,{prop:"categoryLabel",width:"100",align:"center"},{default:m(l=>[f("span",null,g(t.$t(`table.simulation.${l.row.categoryLabel}`)),1)]),_:1}),u(a,{prop:"type",width:"180",align:"center"},{default:m(l=>[f("span",null,g(t.$t(`table.simulation.${l.row.type}`)),1)]),_:1}),u(a,{prop:"value"},{default:m(l=>[f("div",Ae,[u(v,{modelValue:l.row.dataType,"onUpdate:modelValue":o=>l.row.dataType=o},{default:m(()=>[(r(!0),p(h,null,_(l.row.valueTypeList,o=>(r(),y(s,{key:o,value:o},{default:m(()=>[fe(g(O(o,l.row)),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l.row.dataType==="CONFIG"?(r(),p(h,{key:0},[l.row.type==="startTime"?(r(),y(ne,{key:0,class:"ml20",modelValue:l.row.value,"onUpdate:modelValue":o=>l.row.value=o,type:"datetime",placeholder:t.$t("common.placeholder.currentTime"),style:{width:"200px"},clearable:!1},null,8,["modelValue","onUpdate:modelValue","placeholder"])):l.row.type==="startLocation"?(r(),p(h,{key:1},[f("div",Ue,[f("span",null,g(t.$t("common.geo.lon"))+"：",1),u(V,{modelValue:l.row.value.lon,"onUpdate:modelValue":o=>l.row.value.lon=o,placeholder:t.$t("common.geo.lon"),min:-180,max:180,precision:6,controls:!1,style:{width:"150px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),f("div",Ie,[f("span",null,g(t.$t("common.geo.lat"))+"：",1),u(V,{modelValue:l.row.value.lat,"onUpdate:modelValue":o=>l.row.value.lat=o,placeholder:t.$t("common.geo.lat"),min:-90,max:90,precision:6,controls:!1,style:{width:"150px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),f("div",Ne,[f("span",null,g(t.$t("common.geo.alt"))+"：",1),u(V,{modelValue:l.row.value.alt,"onUpdate:modelValue":o=>l.row.value.alt=o,placeholder:t.$t("common.geo.alt"),min:0,max:1e5,precision:6,controls:!1,style:{width:"150px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])])],64)):(r(),p(h,{key:2},[l.row.type==="trajectoryConfig"?(r(),y(L,{key:0,class:"ml20",modelValue:l.row.value,"onUpdate:modelValue":o=>l.row.value=o,placeholder:t.$t("common.placeholder.select"),style:{width:"200px"},"value-key":"fileName",onChange:o=>E(l.row.type,!0)},{default:m(()=>[(r(!0),p(h,null,_(l.row.list,o=>(r(),y(C,{key:o.fileName,label:t.$t(`fileType.${o.fileType}`)+`/${o.fileName}`,value:o},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange"])):l.row.type==="bdsPower"||l.row.type==="antennaConfig"||l.row.type==="eventStreamConfig"?(r(),y(L,{key:1,class:"ml20",modelValue:l.row.value,"onUpdate:modelValue":o=>l.row.value=o,placeholder:t.$t("common.placeholder.select"),style:{width:"200px"},"value-key":"name",onChange:o=>E(l.row.type,!0)},{default:m(()=>[(r(!0),p(h,null,_(l.row.list,o=>(r(),y(C,{key:o.name,label:o.name,value:o.name},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange"])):(r(),y(L,{key:2,class:"ml20",modelValue:l.row.value,"onUpdate:modelValue":o=>l.row.value=o,placeholder:t.$t("common.placeholder.select"),style:{width:"200px"},onChange:o=>E(l.row.type,!0)},{default:m(()=>[(r(!0),p(h,null,_(l.row.list,o=>(r(),y(C,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange"]))],64)),T(l.row)?k("",!0):(r(),p("div",je,[u(N,{effect:"dark",content:l.row.type!=="startLocation"?t.$t("common.placeholder.select"):t.$t("common.placeholder.input")},{default:m(()=>[u(I,{color:"#f56c6c"},{default:m(()=>[u(U)]),_:1})]),_:2},1032,["content"])])),l.row.type!=="startTime"&&l.row.type!=="startLocation"&&!l.row.isExist?(r(),p("div",Fe,[u(N,{effect:"dark",content:t.$t("common.msg.isExist")},{default:m(()=>[u(I,{color:"#f56c6c"},{default:m(()=>[u(U)]),_:1})]),_:1},8,["content"])])):k("",!0)],64)):k("",!0)])]),_:1})]),_:1},8,["data"])])])}}});export{Re as _};
